# AI 教材チャットアプリ - README

## 概要

本アプリは、教師が授業中や事前準備時に活用できる、教育特化型の AI チャットアプリです。以下の機能を MVP として実装済みです：

- プロジェクトごとのチャット履歴管理（例：生徒別、講義別）
- Supabase を用いたバックエンドとデータ永続化
- FastAPI による OpenAI GPT-4o との連携（Docker 対応）
- Flutter によるクロスプラットフォーム UI 構築（Web / モバイル）
- Markdown 形式の AI 出力、PDF 生成、カスタマイズ対応

今後以下のような機能の拡張を、想定：

- WordCloud UI ベースの入力体験とタグ自動生成
- AI エージェントによる対話の最適化（LangGraph、RAG 構成）
- 講師によるフィードバックの蓄積・分析
- ワークスペース共有機能、個別学習最適化

## 技術スタック

### フロントエンド（Flutter）

- flutter_chat_ui + flutter_chat_types によるチャット UI
- Supabase Flutter SDK によるリアルタイム DB 接続
- String.fromEnvironment によるコンパイル時環境変数管理

### バックエンド（FastAPI）

- OpenAI GPT-4o API 連携（openai ライブラリ）
- CORS 対応（Flutter と連携可能）
- Docker による環境管理

### DB（Supabase）

- projects / chats / messages / tags の 4 テーブル構成
- 生徒別や授業別にチャットやタグを保存
- メッセージ種別（user / ai）による分類

## 環境構築方法

### 1. Supabase の準備

- プロジェクト作成
- `.env` に以下を記述：

  ```env
  SUPABASE_URL=xxxxx
  SUPABASE_ANON_KEY=xxxxx
  ```

- SQL エディタにて以下を実行：

  ```sql
  -- 省略（4テーブル作成済み）
  ```

### 2. FastAPI（バックエンド）

- `ai_edu_api/` 配下で `.env` に OpenAI API キーを追加

  ```env
  OPENAI_API_KEY=sk-xxxxx
  ```

- Docker で起動：

  ```bash
  docker compose up --build
  ```

- エンドポイント：`POST http://localhost:8000/chat`

### 3. Flutter（フロントエンド）

- 環境変数をビルド時に指定して起動：

  ```bash
  # 開発環境
  flutter run -d chrome --dart-define=SUPABASE_URL=xxxxx --dart-define=SUPABASE_ANON_KEY=xxxxx

  # または設定ファイルから環境変数を読み込む場合
  flutter run -d chrome --dart-define-from-file=env.json
  ```

- env.json の例：

  ```json
  {
    "SUPABASE_URL": "https://your-supabase-project.supabase.co",
    "SUPABASE_ANON_KEY": "your-supabase-anon-key"
  }
  ```

## ディレクトリ構成（Flutter）

lib/
├── main.dart
├── models/
│ ├── project.dart
│ ├── chat.dart
│ └── message.dart
├── services/
│ ├── project_service.dart
│ ├── chat_service.dart
│ └── message_service.dart
├── screens/
│ ├── project_list_screen.dart
│ ├── project_detail_screen.dart
│ ├── chat_list_screen.dart
│ └── chat_detail_screen.dart
└── widgets/
└── ...（今後）

## デザインガイドライン

- iOS ネイティブ風：

  - 白背景＋シンプルなマテリアル UI
  - ボックスやリストは角丸 + 陰影
  - 吹き出しスタイルでチャット表示（LINE 風）

- ワードクラウド（将来）：

  - ユーザー入力がカードやタグとしてふわっと画面に浮かぶ
  - 関係線（Mapify 風）を描画し、編集可能

  🖌️ デザインガイドライン（UX / UI 概念）
  🌐 コンセプト
  LINE 風 UI： 吹き出し型チャットをベースに、生徒・講師の心理的な親しみやすさを重視。

ChatGPT 的対話構造： ログが蓄積され、AI による再利用・参照が可能。

Notion / Mapify ライクな構造化： キーワード・悩み・要望などを視覚的にマッピング、編集可能なワードクラウド形式で保存。

PDF 教材 ⇄ チャット ⇄ メモ ⇄ 構造化を循環させるハブ型 UI。

🗂️ 画面ごとの構成
画面名概要
project_list_screen 生徒/授業単位のプロジェクト一覧表示（例：中 2・英語）
chat_list_screen プロジェクトごとのチャット履歴一覧。講義回やトピック単位で表示
chat_detail_screenLINE 風チャット画面。AI との対話内容を記録。質問・指導・要望が AI に渡る
wordcloud_screen 🚧 生徒の特徴・悩み・課題をキーワードでクラウド表示。AI・講師・ユーザーが追加・編集可能
pdf_generation_screen 🚧 ワードクラウドやチャットログ、教師要望を元に AI が教材 PDF を生成

🧠 特徴的な UI 仕様
✅ チャット吹き出し UI（ChatGPT+LINE 融合）
AI 左 / ユーザー右に表示されるメッセージバブル。

「再生成」「要望追加」など ChatGPT 風の選択肢ボタン付きバブルも導入予定。

✅ ワードクラウド UI（Mapify ライク）
単語/短文をテキスト入力で追加 → 画面にランダム配置される。

タグの形状や色で意味を区別（例：悩み=四角、不安=三角）。

関連するものは AI または講師が「線」で結びつけられる（手動＋自動対応）。

例：[英語苦手] ←→ [長文読解ができない] のような紐付けが可能。

✅ AI 連携設計
入力されたキーワード・悩み・質問 → AI が文脈を理解して教材/回答を生成。

教材は PDF で出力可能、将来的には "修正要望" のフィードバック付き。

🤝 グループ機能（今後の拡張）
機能概要
複数ユーザー対応講師＋生徒によるプロジェクト参加、権限の切り替え（例：閲覧専用など）
グループチャット UI スレッド形式またはタグ付けされたチャットによる整理
生徒ごとの記憶（Memory）プロジェクト開始時にワードクラウドで入力されたメモリを保持＆参照
要望連携「このような教材がほしい」「この問題がわからなかった」→ AI に反映

🎨 カラーパレットと UI トーン（暫定）
背景： #f9f9f9（Notion 系ライトグレー）

バブル： AI→ 薄青 / ユーザー → グリーン

アクセントカラー： #6C63FF（ワードクラウド線などに使用）

📱 モバイル最適化
各 UI はスマホファーストで設計。

チャット・クラウドともに 1 画面表示に収まるようレスポンシブ対応済み。

ワードクラウド機能（構造化 AI 入力 UI）
✅ 概要
ユーザーの悩み・特徴・ニーズを可視化する、構造的インターフェース。

従来のチャットでは拾いづらい“曖昧な不安や直感”を入力・視覚化する目的。

🎯 主な目的
機能説明
ユーザーの思考の可視化「英語が苦手」「文が長いと読めない」などの抽象的な言葉を並べる
情報の再利用入力されたクラウド情報は AI が参照し、教材生成・再提案・質問に活用
講師との共有ワードクラウドは講師も確認可能。「ここが苦手なんだ」と気づきを得られる

🧩 入力・編集の流れ（UI 仕様） 1.クラウド入力モード
テキスト入力で短文を 1 つずつ追加（「暗記が苦手」「中 2」「英単語嫌い」など）。

送信すると、画面内にランダムに配置されるバッジが生成される。

キーワードはドラッグ可能・編集可。

2.タグ分類
色や形で種類を区別（※以下はデフォルト案）：

種類形状説明
不安三角「テストが怖い」「点数低い」など
キーワード四角「英語」「中 2」「単語力」
特性丸「飽きっぽい」「静か」「真面目」

3.関係線の構築
手動でタグ同士をドラッグして線をつなぐ。

AI が意味的な関連性を自動で提示する候補線も表示（例：「長文読解が苦手」⇄「語彙力がない」）。

🤖 ワードクラウド → 教材生成の流れ
mermaid
コピーする
編集する
graph LR
A[ユーザーがワードを追加] --> B[クラウドに表示]
B --> C[AI が関連性を分析]
C --> D[教材構成を提案]
D --> E[チャットで確認・修正]
E --> F[PDF で教材出力]
🧠 通常のチャットとの違い
特徴通常チャットワードクラウド
入力形式質問形式（1 対 1）単語・短文の蓄積（多対 1）
表示方法吹き出し型の LINE 風 UI マップ型のノード・バブル表示
関係性の表現発言の順序線や色で概念を接続
AI の生成対象回答・補足解説教材（PDF）、グループ化、問題セット
対象者生徒 or 講師単体複数人（グループで共有するクラウド）

📄 最終的な出力イメージ（AI 教材）
要素内容例
教材タトル「英語長文が苦手な中 2 生向け 読解力アップトレーニング」
問題構成ワードクラウドで出た悩みに応じた穴埋め・選択・記述問題
補足チャットで補足されたキーワード（例：「MARCH レベルの問題が解けない」）
コメント挿入 講師による補足メモ、解説や意見が反映（オプション

## 今後の TODO

- [ ] message 保存機能（chat_id に紐づけ）
- [ ] タグ追加・表示画面
- [ ] ユーザー入力による WordCloud の視覚化
- [ ] Markdown 出力 + PDF 連携
- [ ] 教師フィードバックの構造化保存

## 開発者向け Tips

- Supabase の UUID は `gen_random_uuid()` により自動生成
- Flutter で null 許容に注意（required 修飾子）
- Docker の FastAPI 起動に失敗したら `--build` オプション推奨

## 共同開発について

このリポジトリは GitHub で共有されており、今後以下のような開発ルールを想定：

- `main` は常に動作する状態を保持
- 各自 `feature/xxx` ブランチを切って PR ベースで反映
- README は機能追加ごとに更新
- Firebase や Vercel への CI/CD 導入も視野に

---

何か質問や要望があれば `/docs` フォルダに追加予定です。
今後の正式リリースに向けて、MVP の改善と UX の洗練に注力していきます。
